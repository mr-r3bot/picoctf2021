## Code analysis

- Allocate memory for `user` struct on heap

```c
typedef struct {
	uintptr_t (*whatToDo)();
	char *username;
} cmd;

char choice;
cmd *user;
user = (cmd *)malloc(sizeof(user));
```

There are 6 options to choose:
- `S`: get flag
```c
if(user){
 		user->whatToDo = (void*)s;
	}else{
		puts("Not logged in!");
	}
void s(){
 	printf("OOP! Memory leak...%p\n",hahaexploitgobrrr);
 	puts("Thanks for subsribing! I really recommend becoming a premium member!");
}
```
- `P`: 
- `I`: leaving function

```c
void i(){
	char response;
  	puts("You're leaving already(Y/N)?");
	scanf(" %c", &response);
	if(toupper(response)=='Y'){
		puts("Bye!");
		free(user);
	}else{
		puts("Ok. Get premium membership please!");
	}
}

```
- `M`: register with username

```c
puts("Registration: Welcome to Twixer!");
puts("Enter your username: ");
user->username = getsline();
....
char * getsline(void) {
	getchar();
	char * line = malloc(100), * linep = line;
	size_t lenmax = 100, len = lenmax;
	int c;
	if(line == NULL)
		return NULL;
	for(;;) {
		c = fgetc(stdin);
		if(c == EOF)
			break;
		if(--len == 0) {
			len = lenmax;
			char * linen = realloc(linep, lenmax *= 2);

			if(linen == NULL) {
				free(linep);
				return NULL;
			}
			line = linen + (line - linep);
			linep = linen;
		}

		if((*line++ = c) == '\n')
			break;
	}
	*line = '\0';
	return linep;
}

```
- `L`: leave message

```c

void leaveMessage(){
	puts("I only read premium member messages but you can ");
	puts("try anyways:");
	char* msg = (char*)malloc(8);
	read(0, msg, 8);
}

```
- `E`: quit

And then the program exec the function by calling `doProcess`

```c

void doProcess(cmd* obj) {
	(*obj->whatToDo)();
}

```
